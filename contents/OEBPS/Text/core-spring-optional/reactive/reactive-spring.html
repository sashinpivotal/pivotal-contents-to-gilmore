                <!DOCTYPE html>
<html lang="en">
<head>

<meta name="course version" content="1.8.1">
<meta name="generator" content="io.pivotal.pal.shipkin:shipkin-plugin:8.5.2, https://github.com/platform-acceleration-lab/shipkin">
<meta name="generated on" content="2020-05-23T13:27:08.496Z">
<meta name="theme-color" content="#34302d">


<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Core Spring - Reactive Spring (optional)- Reactive Programming with Spring</title>

<link rel="icon" href="../../theme-images/favicon.png">

<link rel="stylesheet" href="../../css/reset.css">
<link rel="stylesheet" href="../../css/theme.css">
<link rel="stylesheet" href="../../css/highlight.js.min.css">
<link rel="stylesheet" href="../../css/github.css">

<style>
    @import url('https://fonts.googleapis.com/css?family=Varela+Round');

    #header {
        border-color: #6db33f;
        background-color: #34302d;
    }

    .disclaimer {
        background-color: #34302d;
    }

    footer {
        background-color: #34302d;
    }

    .label.label-default {
        background-color: #5fa134;
    }

    a {
        color: #5fa134;
    }

    th {
        background-color: #34302d;
        border-color: #34302d;
    }

    blockquote:before {
        color: #34302d;
    }

    .label.label-default:hover, .label.label-default:focus {
        background-color: #6eb043;
    }

    a:hover, a:focus {
        color: #6eb043;
    }

    .slide {
        color: #34302d;
    }

    .slide h2, .slide label {
        color: #5fa134;
    }

    .slide input {
        color: rgba(52, 48, 45, 0.65);
    }

    .face path {
        fill: #5fa134;
    }

    body {
        background-color: #f1f1f1;
    }

    .slide {
        background-color: rgba(241, 241, 241, 0.9);
    }

    .slide.text {
        background-color: #f1f1f1;
    }

    .slide h2, .slide label {
        color: inherit;
    }

    body {
        color: #34302d;
    }

    td {
        border-color: #34302d;
    }

    html, body {
        font-family: 'Varela Round', sans-serif;
    }

</style>

<link rel="stylesheet" href="../../css/custom.css">
</head>
<body>


<style>
    #spring-logo {
        background: url(../../images/spring-logo.png) -1px -1px no-repeat;
    }
    #spring-logo span {
        background: url(../../images/spring-logo.png) -1px -48px no-repeat;
    }
</style>

<header>
    <div class="container">
        <a id="spring-logo"
           href="../.."><span></span></a>

        <p>
            Customer agrees that the <a rel="noreferrer noopener"
                                        href="https://pivotal.io/svcs-terms">Professional
                Services Terms and Conditions</a>
            and the <a rel="noreferrer noopener"
                       href="https://pivotal.io/training/terms">Education
                And Training Services Terms Of Use</a>
            are incorporated by reference into this Data Sheet and shall
            govern the provision of the Pivotal Services and content
            accessible on from this
            page. Customer may not record or reproduce the training in
            any medium. Customer may not copy, reproduce, or distribute
            or otherwise share the
            training materials in any capacity.
        </p>
    </div>
</header>

<div class="container title">
    <h1>Reactive Spring (optional)- Reactive Programming with Spring</h1>
</div>


<a class="feedback" href="https://docs.google.com/forms/d/1EI7PkShHp5FoKHcfYX_eVWJfMtxE-tFTWCPr7H6zodA/viewform" data-url-field="entry.1915922799" target="_blank" rel="noreferrer noopener">
    <button>feedback</button>
</a>

<main id="main">

    <div id="content" class="container">
        <article>
 <h1 id="introduction">Introduction</h1>
<p>This lab is designed to introduce you to some of the basics of Reactive
programming using Spring and the <code>WebClient</code> API.</p>
<p>What you will learn:</p>
<ol>
<li>
<p>How to write a simple Reactive application</p>
</li>
<li>
<p>When Reactive is faster than non-reactive, when it is not</p>
</li>
</ol>
<p>Specific subjects you will gain experience with:</p>
<ol>
<li>
<p>Spring WebClient</p>
</li>
<li>
<p>Mono and Flux from Reactor</p>
</li>
</ol>
<p>You will be using the <em>62-reactive-spring</em> project.</p>
<p>Estimated time to complete: 25 minutes</p>
<h2 id="overview">Overview</h2>
<p>This lab runs a slightly modified version of the REST server you wrote
in an earlier lab.</p>
<p>Everything else involves running as JUnit tests.</p>
<p>The logging output of the Unit tests is important.
A typical log message is shown below.
The item in square brackets is the name of the thread producing the
output, in this case <code>reactor-http-nio-4</code>.
The thread the unit-tests run in is <code>[main]</code>.</p>
<p><code>[reactor-http-nio-4] INFO : rewards.internal.account.Account - Creating new Account ...</code></p>
<h1 id="instructions">Instructions</h1>
<h2 id="reactive-code-demo">Reactive Code Demo</h2>
<ol>
<li>
<p>First you will compare some simple Reactive code</p>
</li>
<li>
<p>Open <code>SimpleReactiveTests.java</code> and run it (TODO-01).
It uses both JDK streams and a Reactive Flux.</p>
</li>
<li>
<p>Notice which threads are used by each part of the test.</p>
</li>
</ol>
<h2 id="run-the-accounts-server">Run the Accounts Server</h2>
<ol>
<li>
<p>Next run the REST server (`AccountsApplication') - this is a Boot
project so you can right-click on the class and <em>Run As &gt;&gt;
Spring Boot App</em> (TODO-02).</p>
</li>
<li>
<p>Check <a href="http://localhost:8080" rel="noreferrer noopener">http://localhost:8080</a> to see that it is working - in
particular the JSON links.</p>
</li>
<li>
<p>The remaining tests all make RESTful requests from the server.</p>
</li>
</ol>
<h2 id="fetch-an-account-using-a-resttemplate">Fetch an Account using a RestTemplate</h2>
<ol>
<li>
<p>(TODO-03) Write the code to fetch an account using a RestTemplate.
The URL is <a href="http://localhost:8080/accounts/0" rel="noreferrer noopener">http://localhost:8080/accounts/0</a>.</p>
</li>
<li>
<p>Remove the <code>@Disabled</code> annotation and run the test ensure it passes.</p>
</li>
<li>
<p>The body of the HTTP response contains JSON data that was converted
to an <code>Account</code> object by Spring.
The <code>Account</code> constructor logs the account creation.
Note that it is also using <code>[main]</code> thread.</p>
</li>
</ol>
<h2 id="fetch-an-account-using-a-web-client">Fetch an Account using a Web Client</h2>
<ol>
<li>
<p>TODO-04: Repeat the fetch, but this time using a WebClient. You will
need to create it, configure it, retrieve the data as a
<code>Mono&lt;Account&gt;</code>.
Use the example in the slides to help you.</p>
</li>
<li>
<p>Block until the account is available - this will return the account
you need.</p>
</li>
<li>
<p>Again, remove the <code>@Disabled</code> annotation and run the test.</p>
</li>
<li>
<p>This time notice that the <code>Account</code> constructor logs in a
<em>different</em> thread.
You have written a multi-threaded application without using Thread
or Callable or …</p>
</li>
</ol>
<h2 id="fetch-multiple-accounts-using-a-web-client">Fetch multiple Accounts using a Web Client</h2>
<ol>
<li>
<p>(TODO-05) This time use the WebClient to fetch all the accounts from
<a href="http://localhost:8080/accounts" rel="noreferrer noopener">http://localhost:8080/accounts</a>.
The code is similar to before but this time use the
<code>bodyToFlux(Account.class)</code> method.</p>
</li>
<li>
<p>(TODO-06) Subscribe to the result and pass a lambda to the
<code>subscribe()</code> to count each item using <code>counter.incrementAndGet()</code>.</p>
</li>
<li>
<p>Remove the <code>@Disabled</code> annotation and run the test.
It should pass by returning 21 accounts.</p>
</li>
</ol>
<h2 id="web-client-vs-resttemplate">Web Client vs RestTemplate</h2>
<ol>
<li>
<p>So which is better?
As this is not a Reactive Programming class we have written the code
for you that runs 200 account fetches, first using a <code>RestTemplate</code>
and then using a <code>WebClient</code>.</p>
</li>
<li>
<p>(TODO-07) Locate the <code>fetchUsingRestTemplate()</code> method in the
the <code>ReactiveWebClientTests</code> class.
Examine the <code>RestTemplate</code> code.
Since there are only 21 accounts we use <code>id % TOTAL_ACCOUNTS</code> to
generate the account id to fetch, as id iterates from 0 - 199.</p>
</li>
<li>
<p>(TODO-08) Now, examine the <code>fetchUsingWebClient()</code> method.
The <code>WebClient</code> code is more involved.
We use the <code>doOnSuccess()</code> method which is just a callback that gets
invoked for each item returned in the Flux.
Here we increment a counter each time it is invoked.
When we reach 200 we determine how long the whole test took to run.</p>
</li>
<li>
<p>(TODO-09) Locate the <code>test4PerformanceTest()</code> test method.
Remove the <code>@Disabled</code> annotation and run the test and notice the
<code>RestTemplate</code> performs fastest due to the overhead of
multi-threading.
The <code>WebClient</code> is not providing any advantage - yet.</p>
</li>
<li>
<p>(TODO-10) What if the Server was slower?
In the <code>AccountsController</code> find <code>TODO-10</code> and uncomment the line to
add a 50s delay to each response.
Once you make the change, stop and re-start the <code>AccountsApplication</code>
server.</p>
</li>
<li>
<p>(TODO-11) Run the test again and now the WebClient performs much
faster due to its ability to run multiple requests in parallel.</p>
</li>
</ol>
<h1 id="summarizing-this-lab">Summarizing this lab</h1>
<p>Since we only have a Spring MVC controller we are stuck with the delay
we introduced, locking up threads from our thread pool.
However if we converted it to a WebFlux reactive controller, we could
mitigate the delay by returning a Mono (putting the delay in the Mono’s
callback code).
The delay is still there (as it would be if you had to perform a slow
database lookup or talk to another system) but the Controller method can
return immediately and free-up its thread.</p>
<p>Congratulations, you have finished the lab.</p>
         </article>
        <div class="sidebar-container">
<nav id="sidebar">
    <div class="title">
        <a href="../../index.html">Return to Core Spring</a>
    </div>
    <div class="content">
        <a href="#">Back to top</a>

<ul>
        <li>
        <a href="#introduction">Introduction</a>

<ul>
        <li>
        <a href="#overview">Overview</a>

        </li>
</ul>
        </li>
        <li>
        <a href="#instructions">Instructions</a>

<ul>
        <li>
        <a href="#reactive-code-demo">Reactive Code Demo</a>

        </li>
        <li>
        <a href="#run-the-accounts-server">Run the Accounts Server</a>

        </li>
        <li>
        <a href="#fetch-an-account-using-a-resttemplate">Fetch an Account using a RestTemplate</a>

        </li>
        <li>
        <a href="#fetch-an-account-using-a-web-client">Fetch an Account using a Web Client</a>

        </li>
        <li>
        <a href="#fetch-multiple-accounts-using-a-web-client">Fetch multiple Accounts using a Web Client</a>

        </li>
        <li>
        <a href="#web-client-vs-resttemplate">Web Client vs RestTemplate</a>

        </li>
</ul>
        </li>
        <li>
        <a href="#summarizing-this-lab">Summarizing this lab</a>

        </li>
</ul>
    </div>
</nav>
        </div>
    </div>
</main>


<div class="slide" data-slide="1">
    <h1>Reactive Spring (optional)- Reactive Programming with Spring</h1>
</div>

<div class="slide transparent" data-slide="2">
    <h1>Get started!</h1>
    <h2>Reactive Spring (optional)- Reactive Programming with Spring</h2>
</div>

<div class="slide" data-slide="3">
    <h1>Wrap up</h1>

    <div class="faces">
        <svg class="face" viewBox="0 0 24 24">
            <path d="M12,2C6.47,2 2,6.47 2,12C2,17.53 6.47,22 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M13,9.94L14.06,11L15.12,9.94L16.18,11L17.24,9.94L15.12,7.82L13,9.94M8.88,9.94L9.94,11L11,9.94L8.88,7.82L6.76,9.94L7.82,11L8.88,9.94M12,17.5C14.33,17.5 16.31,16.04 17.11,14H6.89C7.69,16.04 9.67,17.5 12,17.5Z"/>
        </svg>

        <svg class="face" viewBox="0 0 24 24">
            <path d="M8.5,11A1.5,1.5 0 0,1 7,9.5A1.5,1.5 0 0,1 8.5,8A1.5,1.5 0 0,1 10,9.5A1.5,1.5 0 0,1 8.5,11M15.5,11A1.5,1.5 0 0,1 14,9.5A1.5,1.5 0 0,1 15.5,8A1.5,1.5 0 0,1 17,9.5A1.5,1.5 0 0,1 15.5,11M12,20A8,8 0 0,0 20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20M12,2A10,10 0 0,1 22,12A10,10 0 0,1 12,22C6.47,22 2,17.5 2,12A10,10 0 0,1 12,2M9,14H15A1,1 0 0,1 16,15A1,1 0 0,1 15,16H9A1,1 0 0,1 8,15A1,1 0 0,1 9,14Z"/>
        </svg>

        <svg class="face" viewBox="0 0 24 24">
            <path d="M12,2C6.47,2 2,6.47 2,12C2,17.53 6.47,22 12,22A10,10 0 0,0 22,12C22,6.47 17.5,2 12,2M12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20M16.18,7.76L15.12,8.82L14.06,7.76L13,8.82L14.06,9.88L13,10.94L14.06,12L15.12,10.94L16.18,12L17.24,10.94L16.18,9.88L17.24,8.82L16.18,7.76M7.82,12L8.88,10.94L9.94,12L11,10.94L9.94,9.88L11,8.82L9.94,7.76L8.88,8.82L7.82,7.76L6.76,8.82L7.82,9.88L6.76,10.94L7.82,12M12,14C9.67,14 7.69,15.46 6.89,17.5H17.11C16.31,15.46 14.33,14 12,14Z"/>
        </svg>
    </div>
</div>


<div class="slide lemon-squeezy" data-slide="7">
    <h1>Easy peasy</h1>
    <h1>lemon squeezy!</h1>
</div>

<div class="slide" data-slide="8">
    <h1>Lunch time!</h1>
    <label for="lunch-end">will return</label>
    <input type="text" name="lunch-end" data-time="90">
</div>

<div class="slide" data-slide="9">
    <h1>Break time!</h1>
    <label for="break-end">will return</label>
    <input type="text" name="break-end" data-time="15">
</div>

<audio src="../../audio/gong.mp3"
       id="gong"
       preload>
</audio>

<div class="slide" data-slide="?">
    <h2>Keyboard shortcuts</h2>
    <table>
        <thead>
        <tr>
            <th>Key</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        <tr>
            <td>1</td>
            <td>Show <em>introduction</em> slide</td>
        </tr>
        <tr>
            <td>2</td>
            <td>Show <em>get started</em> slide</td>
        </tr>
        <tr>
            <td>3</td>
            <td>Show <em>wrap up</em> slide</td>
        </tr>
        <tr>
            <td>4</td>
            <td>Show <em>instructor notes</em></td>
        </tr>
        <tr>
            <td>7</td>
            <td>Easy peasy</td>
        </tr>
        <tr>
            <td>8</td>
            <td>Show <em>lunch time</em> slide</td>
        </tr>
        <tr>
            <td>9</td>
            <td>Show <em>break time</em> slide</td>
        </tr>
        <tr>
            <td>0</td>
            <td>Play gong sound</td>
        </tr>
        <tr>
            <td>x</td>
            <td>Close slide</td>
        </tr>
        <tr>
            <td>?</td>
            <td>Show this help message</td>
        </tr>
        </tbody>
    </table>
</div>

<footer>
    <div>
        © Copyright 2020 Pivotal Software, Inc. All Rights Reserved. •
        <a href="https://pivotal.io/privacy-policy" rel="noreferrer noopener">Privacy Policy</a> •
        <a href="https://pivotal.io/legal" rel="noreferrer noopener">Terms of Use</a>
    </div>
    <div>
        <label class="hidden-checkbox">
            <input type="checkbox" id="instructor-mode">
            <span>course version: 1.8.1<sup class="check">IM</sup></span>
        </label>
    </div>
</footer>

<script src="../../js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

<script src="../../js/assignmentSubmission.js"></script>
<script src="../../js/shipkin.js"></script>
<script src="../../js/slides.js"></script>

</body>
</html>

